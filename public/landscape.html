<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Landscape Quiz Creator (16:9)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Outfit', sans-serif; background-color: #0d1223; color: white; }
        .glass { background: rgba(255, 255, 255, 0.03); backdrop-filter: blur(12px); border: 1px solid rgba(255, 255, 255, 0.08); }
        
        /* Landscape Mockup Styles */
        #mockup-landscape {
            width: 500px;
            aspect-ratio: 16/9;
            border-radius: 20px;
            position: relative;
            overflow: hidden;
            box-shadow: 0 40px 80px -12px rgba(0, 0, 0, 0.8);
            border: 8px solid #1e293b;
            margin: 0 auto;
            background: radial-gradient(circle, #00a2ff 0%, #0066cc 100%);
        }

        .sidebar-mock {
            width: 25px;
            background: #0055aa;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #fff;
            font-size: 8px;
            font-weight: 900;
        }

        .mock-landscape-btn {
            background: #ffbb00;
            border: 2px solid #fff;
            border-radius: 10px;
            padding: 8px 15px;
            font-size: 14px;
            font-weight: 800;
            color: #333;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
    </style>
</head>
<body class="p-6 md:p-10">
    <div class="max-w-7xl mx-auto">
        <nav class="flex justify-between items-center mb-10">
            <div>
                <h1 class="text-4xl font-black bg-gradient-to-r from-blue-400 to-indigo-600 bg-clip-text text-transparent">LONG FORM QUIZ</h1>
                <p class="text-slate-500 text-xs font-bold uppercase tracking-widest mt-1">16:9 Widescreen Template</p>
            </div>
            <div class="flex gap-4">
                <a href="/" class="px-5 py-2 rounded-full border border-slate-700 text-[10px] font-bold hover:bg-white/5 transition-all text-slate-400">SWITCH TO SHORTS</a>
                <button onclick="fillSample()" class="px-5 py-2 rounded-full border border-blue-500/30 text-[10px] font-bold bg-blue-500/10 text-blue-400 hover:bg-blue-500/20">LOAD 16:9 SAMPLE</button>
            </div>
        </nav>

        <div class="grid grid-cols-1 lg:grid-cols-12 gap-10">
            <!-- Left: Blocks Container -->
            <div class="lg:col-span-8 space-y-8">
                <div id="blocks-container" class="space-y-6">
                    <!-- Blocks will be injected here -->
                </div>

                <button onclick="addBlock()" class="w-full py-4 border-2 border-dashed border-slate-700 rounded-[32px] text-slate-500 font-bold hover:border-blue-500 hover:text-blue-400 transition-all flex items-center justify-center gap-3 group">
                    <span class="bg-slate-800 w-8 h-8 rounded-full flex items-center justify-center text-xl group-hover:bg-blue-500/20">+</span>
                    ADD NEW QUIZ BLOCK
                </button>
            </div>

            <!-- Right: Global Settings & Action -->
            <div class="lg:col-span-4 space-y-8">
                <section class="glass p-8 rounded-[40px] sticky top-10">
                    <h2 class="text-lg font-black mb-6 text-blue-400 uppercase italic tracking-widest">Global Assets</h2>
                    
                    <div class="space-y-6">
                        <div>
                            <label class="block text-[10px] font-black text-slate-500 uppercase mb-2 tracking-widest pl-2">Background Audio (Optional)</label>
                            <input type="file" id="bgm" accept="audio/*" class="w-full text-[10px] text-slate-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-[10px] file:font-black file:bg-blue-500/10 file:text-blue-400 hover:file:bg-blue-500/20 transition-all cursor-pointer">
                        </div>

                        <div>
                            <label class="block text-[10px] font-black text-slate-500 uppercase mb-2 tracking-widest pl-2">Intro Hook (Spoken)</label>
                            <input type="text" id="introHook" class="w-full bg-slate-900/50 border border-slate-800 rounded-xl px-4 py-3 text-sm text-blue-300 focus:outline-none focus:border-blue-500" placeholder="e.g., Welcome to the Space Quiz!">
                        </div>

                        <div class="pt-6 border-t border-white/5">
                            <button onclick="saveAndGenerate()" id="btnGen" class="w-full bg-gradient-to-r from-blue-500 to-indigo-700 hover:shadow-[0_0_30px_rgba(59,130,246,0.3)] active:scale-95 text-white font-black py-6 rounded-[24px] text-xl transition-all flex flex-col items-center justify-center gap-1 relative overflow-hidden group">
                                <div class="absolute inset-0 bg-white/10 translate-x-[-100%] group-hover:translate-x-[100%] transition-transform duration-700"></div>
                                <span id="spinner" class="hidden animate-spin h-5 w-5 border-4 border-white border-t-transparent rounded-full mb-2"></span>
                                <span id="btnText">RENDER QUEUE</span>
                                <span class="text-[9px] opacity-60 font-bold uppercase tracking-tighter">AI TITLES & UPLOAD INCLUDED</span>
                            </button>
                        </div>
                    </div>

                    <div id="status" class="mt-6 p-4 rounded-2xl hidden text-center font-bold text-[10px] uppercase tracking-tighter"></div>
                </section>
            </div>
        </div>
    </div>

    <script>
        let blockCount = 0;

        function addBlock(data = null) {
            blockCount++;
            const container = document.getElementById('blocks-container');
            const blockId = `block-${blockCount}`;
            
            const blockMarkup = `
                <div id="${blockId}" class="block-item glass p-8 rounded-[40px] relative border-l-8 border-blue-500">
                    <button onclick="removeBlock('${blockId}')" class="absolute top-6 right-6 text-slate-600 hover:text-red-500 transition-all font-black">‚úï</button>
                    
                    <div class="flex items-center gap-4 mb-6">
                        <span class="bg-blue-500 text-white w-10 h-10 rounded-2xl flex items-center justify-center font-black text-lg shadow-lg shadow-blue-500/30">${blockCount}</span>
                        <h3 class="text-sm font-black uppercase tracking-widest text-blue-200">Quiz Block Configuration</h3>
                    </div>

                    <div class="grid grid-cols-2 gap-6 mb-6">
                        <div>
                            <label class="block text-[10px] font-black text-slate-500 uppercase mb-2 tracking-widest pl-2">Format</label>
                            <select class="video-type w-full bg-slate-900 border border-slate-800 rounded-xl px-4 py-3 text-sm text-white font-bold focus:border-blue-500 outline-none">
                                <option value="short" ${data?.type === 'short' ? 'selected' : ''}>SHORT (9:16)</option>
                                <option value="long" ${data?.type === 'long' || !data ? 'selected' : ''}>LONG (16:9)</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-[10px] font-black text-slate-500 uppercase mb-2 tracking-widest pl-2">Template</label>
                            <select class="template-id w-full bg-slate-900 border border-slate-800 rounded-xl px-4 py-3 text-sm text-white font-bold focus:border-blue-500 outline-none">
                                <option value="landscape_industrial" ${data?.templateId === 'landscape_industrial' ? 'selected' : ''}>LANDSCAPE INDUSTRIAL</option>
                                <option value="usa_city_style" ${data?.templateId === 'usa_city_style' ? 'selected' : ''}>USA CITY STYLE</option>
                                <option value="modern_dark" ${data?.templateId === 'modern_dark' ? 'selected' : ''}>MODERN DARK</option>
                            </select>
                        </div>
                    </div>

                    <div>
                        <label class="block text-[10px] font-black text-slate-500 uppercase mb-2 tracking-widest pl-2 text-emerald-500">JSON Question Data</label>
                        <textarea class="quiz-data w-full h-48 bg-black/40 border border-slate-800 rounded-[24px] p-5 text-xs font-mono text-blue-300 focus:border-emerald-500 focus:outline-none transition-all" placeholder="[{ 'question': '...', 'options': [...], ... }]">${data ? JSON.stringify(data.questions, null, 2) : ''}</textarea>
                    </div>
                </div>
            `;
            
            const div = document.createElement('div');
            div.innerHTML = blockMarkup;
            container.appendChild(div);
        }

        function removeBlock(id) {
            document.getElementById(id).remove();
            // Re-index blocks after removal (optional, but good for display)
            const blocks = document.querySelectorAll('.block-item');
            blocks.forEach((block, index) => {
                block.querySelector('.bg-blue-500').textContent = index + 1;
            });
            blockCount = blocks.length; // Reset blockCount to current number of blocks
        }

        function fillSample() {
            // Clear existing blocks
            document.getElementById('blocks-container').innerHTML = '';
            blockCount = 0;

            const sampleBlockData = {
                type: "long",
                templateId: "landscape_industrial",
                questions: [
                    {
                        "question": "WHICH PLANET IS CLOSEST TO THE SUN?",
                        "options": ["Earth", "Mercury", "Venus", "Mars"],
                        "correctIndex": 1,
                        "category": "Space",
                        "image": "images/mercury-sample.jpg"
                    },
                    {
                        "question": "WHAT IS THE CAPITAL OF FRANCE?",
                        "options": ["London", "Berlin", "Paris", "Rome"],
                        "correctIndex": 2,
                        "category": "Geography",
                        "image": "images/paris-sample.jpg"
                    }
                ]
            };
            addBlock(sampleBlockData);
            document.getElementById('introHook').value = "Challenge your brain!";
        }

        async function saveAndGenerate() {
            const btn = document.getElementById('btnGen');
            const btnText = document.getElementById('btnText');
            const spinner = document.getElementById('spinner');
            const status = document.getElementById('status');
            const bgm = document.getElementById('bgm').files[0];
            
            const blocks = document.querySelectorAll('.block-item');
            if (blocks.length === 0) return alert('Add at least one quiz block!');

            const queue = [];
            let isValid = true;

            blocks.forEach(block => {
                try {
                    // Remove any previous error highlighting
                    block.classList.remove('border-red-500');

                    const type = block.querySelector('.video-type').value;
                    const templateId = block.querySelector('.template-id').value;
                    const dataText = block.querySelector('.quiz-data').value;
                    
                    if (!dataText.trim()) throw new Error("Question data is empty");
                    
                    queue.push({
                        type,
                        templateId,
                        questions: JSON.parse(dataText)
                    });
                } catch (e) {
                    isValid = false;
                    block.classList.add('border-red-500');
                    alert('Invalid JSON in block: ' + e.message);
                }
            });

            if (!isValid) return;

            btn.disabled = true;
            spinner.classList.remove('hidden');
            btnText.innerHTML = 'PROCESSING QUEUE...';
            status.innerHTML = '‚öôÔ∏è SYNCING TO CLOUD...';
            status.className = 'mt-4 p-4 rounded-2xl bg-blue-500/10 text-blue-400 block text-center animate-pulse';

            try {
                const formData = new FormData();
                formData.append('data', JSON.stringify({ 
                    queue,
                    global: {
                        introHook: document.getElementById('introHook').value,
                        endScreenMessage: "SUBSCRIBE FOR MORE!"
                    }
                }));

                if (bgm) formData.append('bgm', bgm);

                const saveRes = await fetch('http://localhost:3001/api/save-quiz', { method: 'POST', body: formData });
                const saveResult = await saveRes.json();
                if (!saveResult.success) throw new Error(saveResult.error);

                status.innerHTML = 'üé• RENDERING & AI UPLOADING...';
                const renderRes = await fetch('http://localhost:3001/api/render', { method: 'POST' });
                const renderResult = await renderRes.json();
                if (!renderResult.success) throw new Error(renderResult.error);

                status.innerHTML = 'üèÜ ALL VIDEOS UPLOADED SUCCESSFULLY!';
                status.className = 'mt-4 p-4 rounded-2xl bg-emerald-500/10 text-emerald-400 block text-center font-black';
            } catch (err) {
                status.innerHTML = '‚ö†Ô∏è ERROR: ' + err.message;
                status.className = 'mt-4 p-4 rounded-2xl bg-red-500/10 text-red-500 block text-center';
            } finally {
                btn.disabled = false;
                spinner.classList.add('hidden');
                btnText.innerHTML = 'RENDER QUEUE';
            }
        }

        // Add initial block
        addBlock();
    </script>
</body>
</html>
