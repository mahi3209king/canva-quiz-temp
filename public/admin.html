<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quiz Creator Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Outfit', sans-serif; background-color: #0b0f1a; color: white; }
        .glass { background: rgba(255, 255, 255, 0.03); backdrop-filter: blur(12px); border: 1px solid rgba(255, 255, 255, 0.08); }
        
        /* Mockup Styles */
        #mockup-phone {
            width: 260px;
            height: 462px; /* 9:16 ratio */
            border-radius: 32px;
            position: relative;
            overflow: hidden;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
            border: 6px solid #1e293b;
            margin: 0 auto;
        }
        .mock-option {
            padding: 6px 10px;
            border-radius: 10px;
            font-size: 9px;
            margin-bottom: 5px;
            background: rgba(255,255,255,0.05);
            border: 1px solid rgba(255,255,255,0.1);
            display: flex;
            align-items: center;
            gap: 5px;
        }
        .mock-option.correct {
            background: rgba(74, 222, 128, 0.2);
            border-color: #4ade80;
        }
        
        select option {
            background-color: #1e293b;
            color: white;
        }
    </style>
</head>
<body class="p-6 md:p-10">
    <div class="max-w-6xl mx-auto">
        <header class="mb-10 text-center lg:text-left flex flex-col lg:flex-row lg:items-end justify-between gap-6">
            <div>
                <h1 class="text-5xl font-black bg-gradient-to-r from-sky-400 via-indigo-500 to-pink-500 bg-clip-text text-transparent italic leading-tight">QUIZ MASTER</h1>
                <p class="text-slate-400 mt-2">Professional Quiz Video Automation Pipeline</p>
            </div>
            <div class="flex gap-3">
                <a href="/landscape.html" class="px-6 py-2 rounded-full border border-sky-500/30 text-[10px] font-black hover:bg-sky-500/10 transition-all text-sky-400 flex items-center gap-2">
                    <span class="w-2 h-2 rounded-full bg-sky-400 animate-pulse"></span>
                    LONG VIDEOS (16:9)
                </a>
                <button onclick="fillSample()" class="px-6 py-2 rounded-full border border-slate-700 text-[10px] font-bold hover:bg-white/5 transition-all text-slate-400 hover:text-white uppercase">Sample</button>
            </div>

        </header>

        <div class="grid grid-cols-1 lg:grid-cols-12 gap-8 items-start">
            <!-- Left: Config & Data -->
            <div class="lg:col-span-8 space-y-6">
                <section class="glass p-8 rounded-[32px] shadow-2xl">
                    <h2 class="text-xl font-bold flex items-center gap-3 text-sky-400 mb-6">
                        <span class="bg-sky-500 w-7 h-7 rounded-full flex items-center justify-center text-xs text-white">1</span>
                        Quiz Questions (JSON)
                    </h2>
                    <textarea id="quizData" class="w-full h-96 bg-slate-900/50 border border-slate-800 rounded-2xl p-6 text-sm font-mono text-sky-300 focus:outline-none focus:border-sky-500 transition-all shadow-inner" placeholder='Paste your questions here...'></textarea>
                </section>

                <section class="glass p-8 rounded-[32px] shadow-2xl">
                    <h2 class="text-xl font-bold flex items-center gap-3 text-amber-400 mb-6">
                        <span class="bg-amber-500 w-7 h-7 rounded-full flex items-center justify-center text-xs text-white">2</span>
                        Intro Hook & End Screen
                    </h2>
                    <div class="space-y-4">
                        <div>
                            <label class="block text-[10px] font-black uppercase text-white/30 mb-2">Intro Hook (Line by line, optional)</label>
                            <textarea id="introHook" class="w-full bg-slate-900/50 border border-slate-800 rounded-2xl p-4 text-sm text-sky-300 focus:outline-none focus:border-sky-500" rows="2" placeholder="e.g., 4 out of 6 people fail&#10;answer to all question"></textarea>
                        </div>
                        <div>
                            <label class="block text-[10px] font-black uppercase text-white/30 mb-2">End Screen Message</label>
                            <input type="text" id="endScreenMessage" class="w-full bg-slate-900/50 border border-slate-800 rounded-2xl p-4 text-sm text-amber-300 focus:outline-none focus:border-amber-500" placeholder="e.g., Comment your score below!">
                        </div>
                    </div>
                </section>


                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <section class="glass p-6 rounded-[28px]">
                        <h2 class="text-lg font-bold mb-4 flex items-center gap-3 text-pink-400">
                            <span class="bg-pink-500 w-6 h-6 rounded-full flex items-center justify-center text-xs text-white">3</span>
                            BGM (Optional)
                        </h2>
                        <input type="file" id="bgm" accept="audio/*" class="w-full text-xs text-slate-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-xs file:font-bold file:bg-pink-500/10 file:text-pink-400 hover:file:bg-pink-500/20 transition-all cursor-pointer">
                    </section>
                    <section class="glass p-6 rounded-[28px]">
                        <h2 class="text-lg font-bold mb-4 flex items-center gap-3 text-emerald-400">
                            <span class="bg-emerald-500 w-6 h-6 rounded-full flex items-center justify-center text-xs text-white">4</span>
                            Custom BG (Optional)
                        </h2>
                        <input type="file" id="bgImage" accept="image/*" class="w-full text-xs text-slate-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-xs file:font-bold file:bg-emerald-500/10 file:text-emerald-400 hover:file:bg-emerald-500/20 transition-all cursor-pointer">
                    </section>
                </div>
            </div>

            <!-- Right: Preview, Template Selection & Generate -->
            <div class="lg:col-span-4 space-y-6">
                <section class="glass p-6 rounded-[32px] flex flex-col items-center">
                    <h2 class="text-lg font-bold mb-6 text-amber-500 flex items-center gap-2 self-start">
                         <span class="bg-amber-500 w-6 h-6 rounded-full flex items-center justify-center text-xs text-white">5</span>
                         Live Preview
                    </h2>
                    
                    <div id="mockup-phone" class="mb-8">
                        <div id="mock-bg" class="absolute inset-0 transition-all duration-500"></div>
                        <div class="relative z-10 p-5 flex flex-col h-full">
                            <div class="flex justify-between items-center mb-4">
                                <div id="mock-badge" class="px-3 py-1 rounded-full text-[7px] font-black uppercase flex items-center gap-1">
                                    <div class="w-1.5 h-1.5 rounded-full bg-white/20"></div>
                                    NATURE
                                </div>
                                <div id="mock-number" class="w-4 h-4 rounded-full flex items-center justify-center text-[7px] font-bold">1</div>
                            </div>

                            <div class="bg-white/5 backdrop-blur-md border border-white/10 p-4 rounded-xl mb-6 shadow-xl">
                                <div class="w-5 h-5 rounded-full bg-sky-500/20 flex items-center justify-center mx-auto mb-2">
                                    <div class="w-1.5 h-1.5 rounded-full border-2 border-sky-400"></div>
                                </div>
                                <h3 class="text-center text-[10px] font-black leading-tight mb-1">Which animal is the fastest in the world?</h3>
                            </div>

                            <div class="space-y-1.5">
                                <div class="mock-option"><span class="opacity-50 font-bold">A</span> Cheetah</div>
                                <div id="mock-correct-opt" class="mock-option correct"><span class="opacity-50 font-bold">B</span> Lion <span class="ml-auto">‚úì</span></div>
                                <div class="mock-option"><span class="opacity-50 font-bold">C</span> Eagle</div>
                                <div class="mock-option"><span class="opacity-50 font-bold">D</span> Shark</div>
                            </div>

                            <div class="mt-auto items-center flex flex-col text-center">
                                <div class="w-4 h-4 mb-1 opacity-50">‚ú¶</div>
                                <div class="text-[7px] font-bold text-sky-400 uppercase tracking-widest mb-0.5">Correct Answer</div>
                                <div class="text-[12px] font-black italic">Cheetah</div>
                            </div>
                        </div>
                    </div>

                    <div class="w-full space-y-4">
                        <div class="relative">
                            <label class="text-[10px] font-bold text-slate-500 uppercase tracking-widest block mb-2 px-1">Choose Template Style</label>
                            <select id="templateSelector" onchange="selectTemplate(this.value)" class="w-full bg-slate-900 border border-slate-700 rounded-xl px-4 py-3 text-sm font-bold text-sky-400 focus:outline-none focus:border-sky-500 appearance-none cursor-pointer">
                                <!-- Options injected here -->
                            </select>
                            <div class="absolute right-4 top-10 pointer-events-none opacity-50 text-xs">‚ñº</div>
                        </div>

                        <button onclick="saveAndGenerate()" id="btnGen" class="w-full bg-gradient-to-r from-sky-400 via-indigo-500 to-indigo-600 hover:scale-[1.02] active:scale-95 text-white font-black py-5 rounded-2xl text-lg shadow-xl shadow-sky-500/10 transition-all flex items-center justify-center gap-3 relative overflow-hidden">
                            <span id="spinner" class="hidden animate-spin h-5 w-5 border-3 border-white border-t-transparent rounded-full"></span>
                            <span id="btnText">GENERATE VIDEOS</span>
                        </button>
                    </div>
                </section>
                
                <div id="status" class="p-5 rounded-2xl hidden text-center font-bold text-xs leading-relaxed"></div>
            </div>
        </div>
    </div>

    <script>
        const TEMPLATES = {
            modern_dark: {
                id: 'modern_dark',
                name: 'Modern Dark (Glass)',
                colors: {
                    background: 'linear-gradient(180deg, #0f172a 0%, #1e293b 100%)',
                    primary: '#38bdf8',
                    accent: '#f472b6',
                    surface: 'rgba(255, 255, 255, 0.05)',
                }
            },
            neon_vibe: {
                id: 'neon_vibe',
                name: 'Neon Cyberpunk',
                colors: {
                    background: 'linear-gradient(135deg, #2d0036 0%, #000000 100%)',
                    primary: '#00ccff',
                    accent: '#ff00ff',
                    surface: 'rgba(255, 255, 255, 0.08)',
                }
            },
            minimal_gold: {
                id: 'minimal_gold',
                name: 'Premium Minimal Gold',
                colors: {
                    background: 'linear-gradient(180deg, #1a1a1a 0%, #2a2a2a 100%)',
                    primary: '#fbbf24',
                    accent: '#ffffff',
                    surface: 'rgba(251, 191, 36, 0.05)',
                }
            },
            usa_quiz: {
                id: 'usa_quiz',
                name: 'USA Patriotic Style',
                colors: {
                    background: 'linear-gradient(180deg, #0a192f 0%, #172a45 100%)',
                    primary: '#e62739',
                    accent: '#ffffff',
                    surface: 'rgba(255, 255, 255, 0.07)',
                }
            },
            usa_city_style: {
                id: 'usa_city_style',
                name: 'USA City Style (List)',
                colors: {
                    background: 'linear-gradient(180deg, #1e293b 0%, #0f172a 100%)',
                    primary: '#ff0000',
                    accent: '#ffff00',
                    surface: '#ff0000',
                }
            }
        };



        let activeTemplateId = 'modern_dark';

        function init() {
            const selector = document.getElementById('templateSelector');
            Object.values(TEMPLATES).forEach(template => {
                const opt = document.createElement('option');
                opt.value = template.id;
                opt.textContent = template.name;
                selector.appendChild(opt);
            });
            updateMockup();
            fillSample();
        }

        function selectTemplate(id) {
            activeTemplateId = id;
            updateMockup();
        }

        function updateMockup() {
            const t = TEMPLATES[activeTemplateId];
            const bg = document.getElementById('mock-bg');
            const badge = document.getElementById('mock-badge');
            const num = document.getElementById('mock-number');
            const correct = document.getElementById('mock-correct-opt');
            const phone = document.getElementById('mockup-phone');
            const content = phone.querySelector('.relative.z-10');

            if (activeTemplateId === 'usa_city_style') {
                bg.style.background = 'linear-gradient(to bottom, #2b4b66, #1a2a3a)';
                content.innerHTML = `
                    <div class="flex flex-col h-full items-center">
                        <div style="background: #ff0000; border: 2px solid #000; padding: 4px 15px; border-radius: 8px; margin-top: 10px; box-shadow: 0 4px 0 rgba(0,0,0,0.3)">
                            <div style="color: #ffff00; font-size: 14px; font-weight: 900; -webkit-text-stroke: 0.5px black">ANIMALS QUIZ</div>
                        </div>
                        <div style="margin-top: 20px; color: #fff; font-size: 24px; font-weight: 900; text-shadow: 0 0 10px #00ccff, 2px 2px 0 #000; text-transform: uppercase">PENGUIN</div>
                        <div class="w-full mt-4 px-4 space-y-1 text-left">
                            <div style="color: #ffff00; font-size: 12px; font-weight: 900">EASY:</div>
                            <div style="color: #fff; font-size: 11px; font-weight: 800; padding-left: 10px">1. CAT</div>
                            <div style="color: #fff; font-size: 11px; font-weight: 800; padding-left: 10px">2. RABBIT</div>
                            <div style="color: #00ff00; font-size: 12px; font-weight: 900; margin-top: 4px">MEDIUM:</div>
                            <div style="color: #fff; font-size: 11px; font-weight: 800; padding-left: 10px">4. DOG</div>
                            <div style="color: #ff0000; font-size: 12px; font-weight: 900; margin-top: 4px">HARD:</div>
                            <div style="color: #ffff00; font-size: 11px; font-weight: 800; padding-left: 10px">9. PENGUIN ‚úì</div>
                        </div>
                        <div class="mt-auto mb-4 text-[12px] font-black opacity-80">@QUIZMASTER</div>
                    </div>
                `;
            } else {
                bg.style.background = t.colors.background;
                content.innerHTML = `
                    <div class="flex justify-between items-center mb-4">
                        <div id="mock-badge" class="px-3 py-1 rounded-full text-[7px] font-black uppercase flex items-center gap-1" style="background: ${t.colors.surface}; color: ${t.colors.primary}">
                            <div class="w-1.5 h-1.5 rounded-full bg-white/20"></div>
                            NATURE
                        </div>
                        <div id="mock-number" class="w-4 h-4 rounded-full flex items-center justify-center text-[7px] font-bold" style="background: ${t.colors.primary}; color: #fff">1</div>
                    </div>

                    <div class="bg-white/5 backdrop-blur-md border border-white/10 p-4 rounded-xl mb-6 shadow-xl">
                        <div class="w-5 h-5 rounded-full bg-sky-500/20 flex items-center justify-center mx-auto mb-2">
                            <div class="w-1.5 h-1.5 rounded-full border-2 border-sky-400"></div>
                        </div>
                        <h3 class="text-center text-[10px] font-black leading-tight mb-1 font-bold">Which animal is the fastest in the world?</h3>
                    </div>

                    <div class="space-y-1.5">
                        <div class="mock-option"><span class="opacity-50 font-bold">A</span> Cheetah</div>
                        <div class="mock-option correct" style="background: ${t.colors.primary}33; border-color: ${t.colors.primary}"><span class="opacity-50 font-bold">B</span> Lion <span class="ml-auto">‚úì</span></div>
                        <div class="mock-option"><span class="opacity-50 font-bold">C</span> Eagle</div>
                        <div class="mock-option"><span class="opacity-50 font-bold">D</span> Shark</div>
                    </div>

                    <div class="mt-auto items-center flex flex-col text-center">
                        <div class="w-4 h-4 mb-1 opacity-50">‚ú¶</div>
                        <div class="text-[7px] font-bold text-sky-400 uppercase tracking-widest mb-0.5" style="color: ${t.colors.primary}">Correct Answer</div>
                        <div class="text-[12px] font-black italic">Cheetah</div>
                    </div>
                `;
            }
        }


        function fillSample() {
            const sample = [
                {
                    "question": "WHICH ANIMAL IS THE FASTEST IN THE WORLD?",
                    "Answer": "Cheetah",
                    "category": "Nature",
                    "image": "images/cheetah-sample.jpg"
                }
            ];
            document.getElementById('quizData').value = JSON.stringify(sample, null, 2);
            document.getElementById('endScreenMessage').value = "Comment your score below!";
            document.getElementById('introHook').value = "4 out of 6 people fail\nanswer to all question";
        }




        async function saveAndGenerate() {
            const btn = document.getElementById('btnGen');
            const btnText = document.getElementById('btnText');
            const spinner = document.getElementById('spinner');
            const status = document.getElementById('status');
            const quizData = document.getElementById('quizData').value;
            const endScreenMessage = document.getElementById('endScreenMessage').value;
            const bgm = document.getElementById('bgm').files[0];
            const bgImage = document.getElementById('bgImage').files[0];

            if (!quizData) return alert('Please enter quiz data!');

            btn.disabled = true;
            spinner.classList.remove('hidden');
            btnText.innerHTML = 'PROCESSING...';
            status.innerHTML = '‚öôÔ∏è Saving settings...';
            status.className = 'mt-4 p-4 rounded-2xl bg-sky-500/10 text-sky-400 block text-center animate-pulse';

            try {
                const formData = new FormData();
                formData.append('data', JSON.stringify({ 
                    questions: JSON.parse(quizData),
                    templateId: activeTemplateId,
                    endScreenMessage: endScreenMessage,
                    introHook: document.getElementById('introHook').value
                }));

                if (bgm) formData.append('bgm', bgm);
                if (bgImage) formData.append('bgImage', bgImage);

                const saveRes = await fetch('http://localhost:3001/api/save-quiz', { method: 'POST', body: formData });
                const saveResult = await saveRes.json();
                if (!saveResult.success) throw new Error(saveResult.error);

                status.innerHTML = 'üéôÔ∏è Generating AI Voices & Rendering...';
                const renderRes = await fetch('http://localhost:3001/api/render', { method: 'POST' });
                const renderResult = await renderRes.json();
                if (!renderResult.success) throw new Error(renderResult.error);

                status.innerHTML = '‚úÖ DONE! Check the "out" folder.';
                status.className = 'mt-4 p-4 rounded-2xl bg-emerald-500/10 text-emerald-400 block text-center font-black';
            } catch (err) {
                status.innerHTML = '‚ùå ERROR: ' + err.message;
                status.className = 'mt-4 p-4 rounded-2xl bg-red-500/10 text-red-500 block text-center';
            } finally {
                btn.disabled = false;
                spinner.classList.add('hidden');
                btnText.innerHTML = 'GENERATE VIDEOS';
            }
        }

        init();
    </script>
</body>
</html>
